<script type="text/javascript">
    angular.module('app').controller('HomePageCntrl', [
        '$scope', '$http', '$rootScope', '$filter', '$timeout', function ($scope, $http, $rootScope, $filter, $timeout) {

            $scope.pages = [];
            $scope.itemsOnPage = 5;
            $scope.currentPage = 1;

            $scope.selectPage = function(pageNumber) {
                $scope.currentPage = pageNumber;
                $scope.getfilesList();
            }

            $scope.getfilesList = function () {
                return $http({
                    method: 'GET',
                    url: '@Url.Action("GetDocumentsList", "Documents")',
                    params: {
                        Page: $scope.currentPage,
                        CountOnPage: $scope.itemsOnPage
                    }
                }).then(function (resp) {
                    $scope.files = resp.data.Items;
                    $scope.filesCount = resp.data.Count;
                    var pagesCount = 0;
                    $scope.pages = [];
                    if ($scope.filesCount / $scope.itemsOnPage >= 0) {
                        pagesCount = Math.floor($scope.filesCount / $scope.itemsOnPage);
                    } else {
                        pagesCount = Math.ceil($scope.filesCount / $scope.itemsOnPage);
                    }
                    
                    for (var i = 0; i < pagesCount; i++) {
                        $scope.pages.push(i+1);
                    }
                    if ((pagesCount * $scope.itemsOnPage) !== $scope.filesCount) {
                        $scope.pages.push($scope.pages.length +1);
                    }
                    });
            }

            $scope.removeDocument = function (file) {
                $http.post('@Url.Action("DeleteDocument", "Documents")', { documentId: file.Id }).then(
                    function () {
                        $rootScope.showSuccess("@DocsManagerWebApp.Resources.DocsManagerResources.FileRemoved_message");
                        $scope.getfilesList();
                    });
            };

            $scope.downloadDocument = function(file) {
                window.location.href = "@Url.Action("DownloadDocument", "Documents")?fileId=" + file.Id;
            }

            $timeout(function () {
                $scope.getfilesList();
            });
        }
    ]);
</script>